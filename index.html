<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Soccer Simplex Optimisation</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.10.0/math.min.js"></script>
<style>
body { font-family: Arial; margin: 30px; }
input { margin: 5px; width: 100px; }
table { border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #aaa; padding: 5px; text-align: center; }
th { background-color: #eee; }
button { padding: 5px 10px; }
</style>
</head>
<body>
<h1>Soccer Team Simplex Optimisation</h1>

<div>
<label>Attacker Cost (€): </label><input id="attCost" type="number" value="141636.36" readonly>

<br>
<label>Defender Cost (€): </label><input id="defCost" type="number" value="124157.89" readonly><br>
<label>Attack Threshold (AP): </label><input id="ap" type="number" value="2.5"><br>
<label>Defence Threshold (DP): </label><input id="dp" type="number" value="4.52"><br>
<button id="run">Run Optimisation</button>
</div>

<h2>Results</h2>
<div id="result"></div>

<script>
function runSimplex() {
    const attackerCost = parseFloat(document.getElementById("attCost").value);
    const defenderCost = parseFloat(document.getElementById("defCost").value);
    const AP = parseFloat(document.getElementById("ap").value);
    const DP = parseFloat(document.getElementById("dp").value);

    // Decision variables
    let descion_vars = [
        [0.4273, 0.2464, 1, 0, 0],
        [0.0355, 0.9223, 0, 1, 0],
        [1, 1, 0, 0, 1]
    ];
    let constraints = [AP, DP, 10];
    let optimise = [attackerCost, defenderCost, 1e8, 1e8, 0];

    const constraint_mat = descion_vars.length;
    const variables_mat = descion_vars[0].length;
    const non_basic = variables_mat - constraint_mat;
    let variables_mat_indices = [...Array(variables_mat).keys()];

    while (true) {
        let non_basic_indices = variables_mat_indices.slice(0, non_basic);
        let basic_indices = variables_mat_indices.slice(non_basic);

        // B and N
        let B = math.subset(descion_vars, math.index(math.range(0,constraint_mat), basic_indices));
        let N = math.subset(descion_vars, math.index(math.range(0,constraint_mat), non_basic_indices));

        let B_inv = math.inv(B);

        let current_basic_values = math.multiply(B_inv, constraints);

        // dual_prices = optimise[basic_indices] * B_inv
        let dual_prices = math.multiply(
            basic_indices.map(i => optimise[i]),
            B_inv
        );

        // reduced costs = optimise[non_basic_indices] - dual_prices*N
        let reduced_costs = [];
        for (let j=0;j<non_basic;j++) {
            let col = math.subset(N, math.index(math.range(0,constraint_mat), j));
            let rc = optimise[non_basic_indices[j]] - math.dot(dual_prices, col);
            reduced_costs.push(rc);
        }

        if (reduced_costs.every(c => c >= 0)) break;

        let enter_index = reduced_costs.indexOf(Math.min(...reduced_costs));
        let direction_vector = math.multiply(B_inv, math.subset(N, math.index(math.range(0,constraint_mat), enter_index)));

        // ratio test
        let ratios = direction_vector.map((d,i)=> d>0? current_basic_values[i]/d: Infinity);
        let leave_index = ratios.indexOf(Math.min(...ratios));

        // pivot
        [variables_mat_indices[enter_index], variables_mat_indices[leave_index+non_basic]] =
        [variables_mat_indices[leave_index+non_basic], variables_mat_indices[enter_index]];
    }

    // final solution
    let basic_indices = variables_mat_indices.slice(non_basic);
    let solution = Array(variables_mat).fill(0);
    let B = math.subset(descion_vars, math.index(math.range(0,constraint_mat), basic_indices));
    let B_inv = math.inv(B);
    let current_basic_values = math.multiply(B_inv, constraints);
    basic_indices.forEach((idx,i)=> solution[idx] = current_basic_values[i]);

    let total_cost = solution[0]*attackerCost + solution[1]*defenderCost;

    let html = `<table>
        <tr><th>Type</th><th>Ratio</th><th>Costs (€)</th></tr>
        <tr><td>Attacker</td><td>${solution[0].toFixed(2)}</td><td>€${(solution[0]*attackerCost).toLocaleString()}</td></tr>
        <tr><td>Defender</td><td>${solution[1].toFixed(2)}</td><td>€${(solution[1]*defenderCost).toLocaleString()}</td></tr>
        <tr><td>Slack1</td><td>${solution[2].toFixed(2)}</td><td>€0</td></tr>
        <tr><td>Slack2</td><td>${solution[3].toFixed(2)}</td><td>€0</td></tr>
        <tr><td>Slack3</td><td>${solution[4].toFixed(2)}</td><td>€0</td></tr>
        <tr><td><strong>Total Cost</strong></td><td>-</td><td>€${total_cost.toLocaleString()}</td></tr>
        </table>`;

    document.getElementById("result").innerHTML = html;
}

document.getElementById("run").addEventListener("click", runSimplex);
</script>
</body>
</html>
